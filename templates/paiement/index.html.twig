{% extends 'base.html.twig' %}

{% block title %}Hello PaiementController!{% endblock %}

{% block body %}
<style>
    .example-wrapper { margin: 1em auto; max-width: 800px; width: 95%; font: 18px/1.5 sans-serif; }
    .example-wrapper code { background: #F5F5F5; padding: 2px 6px; }
</style>

{% if not data %}
<div class="example-wrapper">
    <h1>{{ controller_name }}</h1>

    Vous etes sur le point d'Ã©ffectuer un paiement:

    {{ form(paiementForm) }}
</div>
{% else %}
<script>
var datain =  {{data|json_encode()|raw}};
var jsonform = JSON.stringify(datain);
var myParam = location.search.split('p=')[1]
var decrypted = CryptoJS.AES.decrypt(myParam, "Secret Passphrase");
var idabonement = decrypted.toString(CryptoJS.enc.Utf8);
var itemabbo=[];
alert(idabonement+" "+decrypted);
if (typeof(Storage) !== "undefined") {
  // Store
 // localStorage.setItem("lastname", "Smith");
  // Retrieve
  itemabbo=localStorage.getItem(idabonement);
  
} else {
  //document.getElementById("result").innerHTML = "Sorry, your browser does not support Web Storage...";
}

console.log(itemabbo);
 $.ajax('api/paiementretour', {
    method: "POST",
    contentType: 'application/json',
    processData: false,
    data: jsonform
    })
    
    .then(
    function success(data) {
   
        alert('modification prise en compte');
       
       
       
       
    }
);   
</script>
{% endif %}
{% endblock %}
